<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S·ªï tay PCCC & CNCH T∆∞∆°ng t√°c (v·ªõi Gemini AI) - C·∫£ng HKQT C·∫ßn Th∆°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Calm Harmony (Slate/Gray, White, Blue, Red, Amber for AI) -->
    <!-- Application Structure Plan: The application uses a task-oriented, card-based navigation system instead of mirroring the report's linear chapters. This allows users to quickly select their specific airport zone (e.g., 'Public Areas', 'Technical Areas') and view relevant rules. Emergency contact information is given top priority in a fixed header. This structure prioritizes immediate access to relevant information over formal document structure, enhancing usability for airport staff and tenants in real-world scenarios. Gemini AI features (Q&A bot, Checklist Generator) are added to transform the static guide into an interactive assistant. -->
    <!-- Visualization & Content Choices: Report Info: Area-specific rules. Goal: Inform/Guide. Presentation: Interactive accordions. Interaction: Click to expand/collapse. Justification: Breaks down dense text. Library: Vanilla JS. Report Info: Emergency contacts. Goal: Alert. Presentation: Fixed header banner. Interaction: None. Justification: Critical info is always visible. Gemini Feature 1: Natural Language Q&A. Goal: Answer specific user queries. Presentation: Modal with input and response area. Interaction: User types question, receives AI-generated answer based on report context. Justification: Provides immediate, contextual answers without manual searching. Gemini Feature 2: Safety Checklist Generation. Goal: Create actionable tools. Presentation: Button that generates a formatted list. Interaction: User clicks button, AI generates a checklist based on the current zone's rules using a JSON schema. Justification: Transforms passive rules into a practical, daily-use tool for safety inspections. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .main-header {
            background-color: #ffffff;
            border-bottom: 1px solid #e2e8f0; /* slate-200 */
        }
        .emergency-banner {
            background-color: #dc2626; /* red-600 */
            color: white;
            /* Removed sticky positioning as requested */
        }
        .nav-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .nav-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .nav-card.active {
            border-color: #2563eb; /* blue-600 */
            transform: translateY(-2px);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4);
        }
        .content-section h3 {
            cursor: pointer;
            border-bottom: 1px solid #e5e7eb; /* gray-200 */
            padding-bottom: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .content-section ul { list-style: none; padding-left: 0.5rem; }
        .content-section li { display: flex; align-items: flex-start; margin-bottom: 0.5rem; }
        .content-section li::before {
            margin-right: 0.75rem;
            flex-shrink: 0;
            font-weight: bold;
            font-size: 1.25rem;
            line-height: 1.5rem;
        }
        .responsibility li::before { content: '‚úì'; color: #16a34a; /* green-600 */ }
        .prohibition li::before { content: '‚úó'; color: #dc2626; /* red-600 */ }
        .safety li::before { content: 'üõ°Ô∏è'; }
        .emergency li::before { content: 'üî•'; color: #f97316; /* orange-500 */ }
        
        .accordion-content { display: none; overflow: hidden; transition: max-height 0.3s ease-in-out; }
        .accordion-content.show { display: block; }
        .accordion-arrow { transition: transform 0.3s ease-in-out; }
        .accordion-header.open .accordion-arrow { transform: rotate(180deg); }

        /* Gemini Features Styling */
        .gemini-fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background-color: #2563eb; /* blue-600 */
            color: white;
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            z-index: 100;
        }
        .gemini-fab:hover { transform: scale(1.1); }
        .gemini-modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 110;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .gemini-modal-overlay.show { opacity: 1; visibility: visible; }
        .gemini-modal {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transform: scale(0.95);
            transition: transform 0.3s;
        }
        .gemini-modal-overlay.show .gemini-modal { transform: scale(1); }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 1rem auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .checklist-container { border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 1rem; margin-top: 1.5rem; }
    </style>
</head>
<body class="text-slate-800">

    <div id="emergency-contact" class="emergency-banner p-4 text-center shadow-lg">
        <div class="container mx-auto flex items-center justify-center gap-4">
            <span class="text-2xl font-bold">üìû</span>
            <div>
                <h2 class="text-lg md:text-xl font-bold uppercase">B√°o ch√°y & S·ª± c·ªë kh·∫©n c·∫•p</h2>
                <div class="flex flex-wrap justify-center items-center gap-x-6 gap-y-2 mt-1">
                    <p class="font-semibold">N·ªôi b·ªô: <span class="text-xl">102</span></p>
                    <p class="font-semibold">Hotline AOC: <span class="text-xl">0939 976 525</span></p>
                    <p class="font-semibold">C·∫£nh s√°t PCCC: <span class="text-xl">114</span></p>
                </div>
            </div>
        </div>
    </div>

    <header class="main-header py-6 shadow-md">
        <div class="container mx-auto text-center px-4">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-700">S·ªï tay PCCC & CNCH T∆∞∆°ng t√°c</h1>
            <p class="text-lg text-slate-600 mt-2">C·∫£ng H√†ng kh√¥ng Qu·ªëc t·∫ø C·∫ßn Th∆°</p>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        <section id="zone-selection" class="text-center mb-8">
            <h2 class="text-2xl font-semibold mb-2">Ch·ªçn khu v·ª±c c·ªßa b·∫°n</h2>
            <p class="text-slate-500 max-w-2xl mx-auto">Nh·∫•p v√†o m·ªôt khu v·ª±c d∆∞·ªõi ƒë√¢y ƒë·ªÉ xem c√°c quy ƒë·ªãnh PCCC & CNCH chi ti·∫øt.</p>
            <div id="nav-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-6"></div>
        </section>

        <section id="content-display" class="bg-white p-6 rounded-lg shadow-lg min-h-[300px]">
             <div id="placeholder" class="flex flex-col items-center justify-center h-full text-center text-slate-500">
                <span class="text-6xl mb-4">üìñ</span>
                <p class="text-lg font-medium">N·ªôi dung chi ti·∫øt s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y.</p>
                <p>Vui l√≤ng ch·ªçn m·ªôt khu v·ª±c t·ª´ danh s√°ch tr√™n.</p>
            </div>
        </section>
    </main>

    <!-- Gemini Q&A FAB -->
    <div id="gemini-fab" class="gemini-fab" title="H·ªèi ƒë√°p nhanh v·ªÅ PCCC">?</div>

    <!-- Gemini Q&A Modal -->
    <div id="gemini-modal-overlay" class="gemini-modal-overlay">
        <div class="gemini-modal">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-blue-700">‚ú® Tr·ª£ l√Ω H·ªèi-ƒê√°p An to√†n PCCC</h3>
                <button id="close-modal-btn" class="text-2xl text-slate-500 hover:text-slate-800">&times;</button>
            </div>
            <p class="text-slate-600 mb-4">ƒê·∫∑t c√¢u h·ªèi v·ªÅ quy ƒë·ªãnh PCCC t·∫°i s√¢n bay. V√≠ d·ª•: "T√¥i c√≥ ƒë∆∞·ª£c h√∫t thu·ªëc ·ªü nh√† xe kh√¥ng?"</p>
            <div class="flex gap-2">
                <input type="text" id="qa-input" class="w-full border border-slate-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n...">
                <button id="qa-submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 font-semibold">G·ª≠i</button>
            </div>
            <div id="qa-response-area" class="mt-4 p-4 bg-slate-50 rounded-md min-h-[100px]">
                <p class="text-slate-500 text-center">C√¢u tr·∫£ l·ªùi s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y.</p>
            </div>
        </div>
    </div>

    <footer class="text-center p-6 text-slate-500 text-sm">
        <p>Theo Quy·∫øt ƒë·ªãnh s·ªë 712/Qƒê-CHKQTCT ng√†y 07/07/2025</p>
        <p>&copy; 2025 C·∫£ng H√†ng kh√¥ng Qu·ªëc t·∫ø C·∫ßn Th∆°</p>
    </footer>

    <script>
        const fireSafetyData = {
            public: {
                title: "Khu v·ª±c C√¥ng c·ªông", icon: "üë•", description: "Nh√† ga, VƒÉn ph√≤ng, Nh√† xe, Qu·∫ßy kinh doanh, B·∫øp ƒÉn.",
                content: {
                    responsibilities: { title: "Tr√°ch nhi·ªám PCCC & CNCH", points: ["L√† nghƒ©a v·ª• b·∫Øt bu·ªôc c·ªßa m·ªçi t·ªï ch·ª©c, c√° nh√¢n, CB-NV v√† h√†nh kh√°ch.", "Lu√¥n ∆∞u ti√™n c·ª©u ng∆∞·ªùi, b·∫£o v·ªá t√†i s·∫£n, ph·ªëi h·ª£p x·ª≠ l√Ω s·ª± c·ªë.", "Ng∆∞·ªùi ƒë·ª©ng ƒë·∫ßu ƒë∆°n v·ªã thu√™ m·∫∑t b·∫±ng ch·ªãu tr√°ch nhi·ªám to√†n di·ªán v·ªÅ PCCC.", "Tham gia hu·∫•n luy·ªán, di·ªÖn t·∫≠p PCCC & CNCH ƒë·ªãnh k·ª≥."] },
                    safety: { title: "Quy ƒë·ªãnh an to√†n chung", points: ["H√†ng h√≥a trong kho, qu·∫ßy h√†ng ph·∫£i s·∫Øp x·∫øp g·ªçn g√†ng, c√°ch xa ngu·ªìn nhi·ªát.", "B·∫øp ƒÉn ph·∫£i th√¥ng tho√°ng, c√≥ h·ªá th·ªëng h√∫t kh√≥i, nh√¢n vi√™n ƒë∆∞·ª£c hu·∫•n luy·ªán.", "Pin Lithium (trong xe ƒëi·ªán, thi·∫øt b·ªã) ph·∫£i ƒë∆∞·ª£c l∆∞u tr·ªØ trong h·ªôp ch·ªëng ch√°y, kh√¥ng s·∫°c qua ƒë√™m.", "Xe trong b√£i/nh√† xe ph·∫£i ƒë·ªó ƒë√∫ng n∆°i quy ƒë·ªãnh, kh√¥ng r√≤ r·ªâ nhi√™n li·ªáu.", "L·ªëi tho√°t hi·ªÉm, ƒë√®n s·ª± c·ªë, bi·ªÉn b√°o ph·∫£i lu√¥n th√¥ng tho√°ng, ho·∫°t ƒë·ªông t·ªët."] },
                    prohibitions: { title: "C√°c h√†nh vi b·ªã c·∫•m", points: ["H√∫t thu·ªëc, ƒë·ªët l·ª≠a, ƒëun n·∫•u, th·∫Øp h∆∞∆°ng tr√°i ph√©p.", "T·ª± √Ω c√¢u m√≥c, thay ƒë·ªïi k·∫øt c·∫•u h·ªá th·ªëng ƒëi·ªán.", "Mang ch·∫•t ch√°y n·ªï, ch·∫•t ƒë·ªôc v√†o nh√† ga, nh√† xe.", "C·∫£n tr·ªü ho·∫°t ƒë·ªông PCCC, che khu·∫•t ph∆∞∆°ng ti·ªán ch·ªØa ch√°y.", "B√°o ch√°y gi·∫£, ch·ªëng ng∆∞·ªùi thi h√†nh nhi·ªám v·ª•."] },
                    emergency: { title: "Khi c√≥ s·ª± c·ªë ch√°y, n·ªï", points: ["H√¥ to b√°o ƒë·ªông, t√¨m c√°ch ng·∫Øt ƒëi·ªán/gas khu v·ª±c.", "S·ª≠ d·ª•ng ngay b√¨nh ch·ªØa ch√°y, ph∆∞∆°ng ti·ªán t·∫°i ch·ªó ƒë·ªÉ d·∫≠p l·ª≠a.", "TUY·ªÜT ƒê·ªêI KH√îNG d√πng n∆∞·ªõc d·∫≠p ch√°y d·∫ßu m·ª° ho·∫∑c ch√°y pin Lithium.", "H∆∞·ªõng d·∫´n m·ªçi ng∆∞·ªùi tho√°t n·∫°n theo l·ªëi tho√°t hi·ªÉm g·∫ßn nh·∫•t."] }
                }
            },
            technical: {
                title: "Khu v·ª±c K·ªπ thu·∫≠t", icon: "‚öôÔ∏è", description: "X∆∞·ªüng c∆° kh√≠, Tr·∫°m ngu·ªìn, Kho v·∫≠t t∆∞, Tr·∫°m ƒëi·ªán, Ph√≤ng b∆°m.",
                content: {
                    responsibilities: { title: "Tr√°ch nhi·ªám PCCC & CNCH", points: ["L√† tr√°ch nhi·ªám b·∫Øt bu·ªôc c·ªßa m·ªçi CB-NV l√†m vi·ªác t·∫°i khu v·ª±c.", "An to√†n cho ng∆∞·ªùi v√† thi·∫øt b·ªã l√† ∆∞u ti√™n h√†ng ƒë·∫ßu.", "Ch·ªâ ng∆∞·ªùi c√≥ chuy√™n m√¥n, ƒë∆∞·ª£c ƒë√†o t·∫°o m·ªõi ƒë∆∞·ª£c v·∫≠n h√†nh, s·ª≠a ch·ªØa thi·∫øt b·ªã.", "Gi√°m s√°t an to√†n trong su·ªët qu√° tr√¨nh l√†m vi·ªác, ƒë·∫∑c bi·ªát l√† khi h√†n c·∫Øt."] },
                    safety: { title: "Quy ƒë·ªãnh an to√†n chung", points: ["Ho·∫°t ƒë·ªông h√†n ƒëi·ªán, h√†n h∆°i ph·∫£i c√≥ gi·∫•y ph√©p, ng∆∞·ªùi gi√°m s√°t v√† che ch·∫Øn b·∫±ng v·∫≠t li·ªáu ch·ªëng ch√°y.", "V·ªá sinh s·∫°ch s·∫Ω khu v·ª±c h√†n, di d·ªùi v·∫≠t d·ªÖ ch√°y c√°ch xa t·ªëi thi·ªÉu 2m.", "Thi·∫øt b·ªã ƒëi·ªán c√¥ng su·∫•t l·ªõn ph·∫£i c√≥ aptomat ri√™ng, d√¢y d·∫´n ƒë√∫ng ti·∫øt di·ªán.", "Thi·∫øt b·ªã ƒëi·ªán t·∫°i khu v·ª±c xƒÉng d·∫ßu, h√≥a ch·∫•t ph·∫£i l√† lo·∫°i ph√≤ng n·ªï.", "Tr·∫°m ƒëi·ªán, m√°y ph√°t ph·∫£i c√≥ h·ªá th·ªëng ti·∫øp ƒë·ªãa, ch·ªëng s√©t, th√¥ng gi√≥ ƒë·∫ßy ƒë·ªß.", "Th∆∞·ªùng xuy√™n ki·ªÉm tra ƒë·ªãnh k·ª≥ h·ªá th·ªëng ƒëi·ªán, m√°y m√≥c, thi·∫øt b·ªã."] },
                    prohibitions: { title: "C√°c h√†nh vi b·ªã c·∫•m", points: ["H√∫t thu·ªëc, s·ª≠ d·ª•ng l·ª≠a tr·∫ßn, ƒëi·ªán tho·∫°i di ƒë·ªông t·∫°i khu v·ª±c c√≥ nguy c∆° ch√°y n·ªï cao.", "Ng∆∞·ªùi kh√¥ng c√≥ nhi·ªám v·ª• t·ª± √Ω v√†o khu v·ª±c k·ªπ thu·∫≠t, tr·∫°m ƒëi·ªán.", "T·ª± √Ω ƒë·∫•u n·ªëi, thay ƒë·ªïi k·∫øt c·∫•u thi·∫øt b·ªã ƒëi·ªán.", "ƒê·ªÉ v·∫≠t t∆∞, h√†ng h√≥a c·∫£n tr·ªü l·ªëi ƒëi, che khu·∫•t thi·∫øt b·ªã PCCC.", "S·ª≠ d·ª•ng thi·∫øt b·ªã h√†n, ƒëi·ªán kh√¥ng ƒë·∫£m b·∫£o an to√†n (r√≤ r·ªâ, h·ªü ƒëi·ªán)."] },
                    emergency: { title: "Khi c√≥ s·ª± c·ªë ch√°y, n·ªï", points: ["H√¥ to b√°o ƒë·ªông, nhanh ch√≥ng ng·∫Øt ngu·ªìn ƒëi·ªán b·∫±ng aptomat ch√≠nh.", "S·ª≠ d·ª•ng b√¨nh ch·ªØa ch√°y CO2, b√¨nh b·ªôt kh√¥ ƒë·ªÉ d·∫≠p l·ª≠a.", "S·∫µn s√†ng ph∆∞∆°ng √°n di d·ªùi t√†i s·∫£n, v·∫≠t t∆∞ quan tr·ªçng n·∫øu c√≥ th·ªÉ.", "G·ªçi ngay cho l·ª±c l∆∞·ª£ng chuy√™n tr√°ch ƒë·ªÉ h·ªó tr·ª£."] }
                }
            },
            airside: {
                title: "Khu v·ª±c Ho·∫°t ƒë·ªông bay", icon: "‚úàÔ∏è", description: "S√¢n ƒë·ªó t√†u bay, Tr·ª• b∆°m nhi√™n li·ªáu, Khu ƒëi·ªÅu h√†nh bay (ATC).",
                content: {
                     responsibilities: { title: "Tr√°ch nhi·ªám PCCC & CNCH", points: ["L√† tr√°ch nhi·ªám b·∫Øt bu·ªôc c·ªßa m·ªçi CB-NV v√† ƒë∆°n v·ªã ho·∫°t ƒë·ªông t·∫°i s√¢n ƒë·ªó.", "ƒê·∫£m b·∫£o an to√†n tuy·ªát ƒë·ªëi, duy tr√¨ ho·∫°t ƒë·ªông ƒëi·ªÅu h√†nh bay li√™n t·ª•c.", "Nh√¢n vi√™n v·∫≠n h√†nh ph∆∞∆°ng ti·ªán, thi·∫øt b·ªã ph·∫£i ƒë∆∞·ª£c hu·∫•n luy·ªán PCCC.", "B·∫£o v·ªá nghi√™m ng·∫∑t c√°c thi·∫øt b·ªã ƒë·∫∑c bi·ªát quan tr·ªçng (ATC, Radar...)."] },
                    safety: { title: "Quy ƒë·ªãnh an to√†n chung", points: ["Khi tra n·∫°p nhi√™n li·ªáu, ph∆∞∆°ng ti·ªán ph·∫£i t·∫Øt m√°y, n·ªëi ƒë·∫•t, gi·ªØ kho·∫£ng c√°ch an to√†n.", "T·∫•t c·∫£ c√°c ph∆∞∆°ng ti·ªán ho·∫°t ƒë·ªông t·∫°i s√¢n ƒë·ªó ph·∫£i ƒë∆∞·ª£c trang b·ªã b√¨nh ch·ªØa ch√°y.", "Khu v·ª±c ƒëi·ªÅu h√†nh bay (ATC) ph·∫£i ƒë∆∞·ª£c trang b·ªã h·ªá th·ªëng b√°o ch√°y, ch·ªØa ch√°y t·ª± ƒë·ªông v√† ho·∫°t ƒë·ªông t·ªët.", "Thi·∫øt b·ªã ƒëi·ªán, UPS, ƒëi·ªÅu h√≤a trong khu v·ª±c ATC ph·∫£i c√≥ aptomat ri√™ng v√† ƒë∆∞·ª£c ki·ªÉm tra ƒë·ªãnh k·ª≥."] },
                    prohibitions: { title: "C√°c h√†nh vi b·ªã c·∫•m", points: ["H√∫t thu·ªëc, s·ª≠ d·ª•ng ƒëi·ªán tho·∫°i, ƒë·ªÉ ƒë·ªông c∆° xe ho·∫°t ƒë·ªông t·∫°i khu v·ª±c tr·ª• b∆°m, s√¢n ƒë·ªó.", "Mang ngu·ªìn nhi·ªát, ch·∫•t ch√°y n·ªï, h√≥a ch·∫•t v√†o khu v·ª±c s√¢n ƒë·ªó, ATC.", "T·ª± √Ω thay ƒë·ªïi, l·∫Øp ƒë·∫∑t thi·∫øt b·ªã ƒëi·ªán, m·∫°ng trong khu v·ª±c ƒëi·ªÅu h√†nh bay m√† kh√¥ng c√≥ ph√™ duy·ªát.", "V√¥ hi·ªáu h√≥a, che ch·∫Øn h·ªá th·ªëng b√°o ch√°y, ch·ªØa ch√°y, l·ªëi tho√°t n·∫°n.", "B√°o ch√°y gi·∫£, l√†m m·∫•t t√≠n hi·ªáu b√°o ch√°y k·∫øt n·ªëi v·ªÅ trung t√¢m."] },
                    emergency: { title: "Khi c√≥ s·ª± c·ªë ch√°y, n·ªï", points: ["H√¥ to b√°o ƒë·ªông cho m·ªçi ng∆∞·ªùi xung quanh.", "C·∫Øt ƒëi·ªán khu v·ª±c s·ª± c·ªë b·∫±ng aptomat.", "D√πng ph∆∞∆°ng ti·ªán t·∫°i ch·ªó (b√¨nh CO2, b·ªôt) ƒë·ªÉ x·ª≠ l√Ω ban ƒë·∫ßu.", "∆Øu ti√™n b·∫£o v·ªá h·ªá th·ªëng, thi·∫øt b·ªã ƒëi·ªÅu h√†nh bay, ƒë·∫£m b·∫£o ho·∫°t ƒë·ªông kh√¥ng gi√°n ƒëo·∫°n."] }
                }
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            const navContainer = document.getElementById('nav-container');
            const contentDisplay = document.getElementById('content-display');
            const placeholder = document.getElementById('placeholder');

            // Gemini Modal Elements
            const fab = document.getElementById('gemini-fab');
            const modalOverlay = document.getElementById('gemini-modal-overlay');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const qaSubmitBtn = document.getElementById('qa-submit');
            const qaInput = document.getElementById('qa-input');
            const qaResponseArea = document.getElementById('qa-response-area');

            // --- Gemini API Helper ---
            async function callGemini(prompt, isJson = false, schema = null) {
                const apiKey = ""; // Left blank for environment injection
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                let payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }]
                };

                if (isJson && schema) {
                    payload.generationConfig = {
                        responseMimeType: "application/json",
                        responseSchema: schema
                    };
                }

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorBody = await response.text();
                        console.error("API Error Response:", errorBody);
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        console.error("Unexpected API response structure:", result);
                        throw new Error("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c n·ªôi dung h·ª£p l·ªá t·ª´ AI.");
                    }
                } catch (error) {
                    console.error("Error calling Gemini API:", error);
                    return `ƒê√£ x·∫£y ra l·ªói: ${error.message}. Vui l√≤ng th·ª≠ l·∫°i.`;
                }
            }

            function createAccordionItem(id, title, points, typeClass) {
                const isFirst = id.endsWith('responsibilities');
                const isOpen = isFirst ? 'open' : '';
                const isShow = isFirst ? 'show' : '';
                let listItems = points.map(point => `<li>${point}</li>`).join('');
                return `<div class="content-section mb-4">
                            <h3 id="${id}" class="accordion-header ${isOpen} flex justify-between items-center text-lg font-semibold text-slate-700 hover:text-blue-600">
                                <span>${title}</span>
                                <span class="accordion-arrow text-blue-600 text-2xl font-light transform transition-transform">‚ñæ</span>
                            </h3>
                            <div class="accordion-content ${isShow} mt-2 pl-2"><ul class="${typeClass}">${listItems}</ul></div>
                        </div>`;
            }

            function displayContent(zoneKey) {
                placeholder.style.display = 'none';
                const zoneData = fireSafetyData[zoneKey];
                let contentHTML = `<div class="flex justify-between items-start">
                                      <h2 class="text-2xl font-bold mb-4 text-blue-700">${zoneData.icon} ${zoneData.title}</h2>
                                      <button id="checklist-btn" data-zone="${zoneKey}" class="bg-amber-500 text-white px-4 py-2 rounded-md hover:bg-amber-600 font-semibold text-sm">‚ú® T·∫°o Checklist</button>
                                   </div>
                                   <div id="checklist-container-${zoneKey}" class="hidden"></div>`;

                const sections = [
                    { key: 'responsibilities', class: 'responsibility' },
                    { key: 'safety', class: 'safety' },
                    { key: 'prohibitions', class: 'prohibition' },
                    { key: 'emergency', class: 'emergency' }
                ];
                
                sections.forEach(section => {
                    if(zoneData.content[section.key]) {
                        contentHTML += createAccordionItem(`${zoneKey}-${section.key}`, zoneData.content[section.key].title, zoneData.content[section.key].points, section.class);
                    }
                });

                contentDisplay.innerHTML = contentHTML;

                document.querySelectorAll('.accordion-header').forEach(header => {
                    header.addEventListener('click', function() {
                        this.classList.toggle('open');
                        this.nextElementSibling.classList.toggle('show');
                    });
                });

                document.getElementById('checklist-btn').addEventListener('click', handleChecklistGeneration);
            }
            
            async function handleChecklistGeneration(event) {
                const button = event.target;
                const zoneKey = button.dataset.zone;
                const container = document.getElementById(`checklist-container-${zoneKey}`);
                
                button.disabled = true;
                button.innerHTML = '<div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"></div>';
                container.classList.remove('hidden');
                container.innerHTML = `<div class="loader"></div><p class="text-center text-slate-500">AI ƒëang t·∫°o checklist, vui l√≤ng ch·ªù...</p>`;

                const zoneRules = fireSafetyData[zoneKey].content;
                const context = `Quy ƒë·ªãnh an to√†n: ${zoneRules.safety.points.join('. ')}. H√†nh vi c·∫•m: ${zoneRules.prohibitions.points.join('. ')}`;
                const prompt = `D·ª±a tr√™n n·ªôi quy sau ƒë√¢y cho m·ªôt khu v·ª±c t·∫°i s√¢n bay, h√£y t·∫°o m·ªôt checklist ki·ªÉm tra an to√†n PCCC h√†ng ng√†y. Ph√¢n lo·∫°i t·ª´ng m·ª•c ki·ªÉm tra. N·ªôi quy: "${context}"`;
                const schema = {
                    type: "OBJECT",
                    properties: {
                        checklist: {
                            type: "ARRAY",
                            items: {
                                type: "OBJECT",
                                properties: {
                                    category: { type: "STRING" },
                                    item: { type: "STRING" }
                                },
                                required: ["category", "item"]
                            }
                        }
                    },
                    required: ["checklist"]
                };

                const result = await callGemini(prompt, true, schema);
                button.disabled = false;
                button.innerHTML = '‚ú® T·∫°o l·∫°i Checklist';

                try {
                    const parsedResult = JSON.parse(result);
                    if (parsedResult.checklist && parsedResult.checklist.length > 0) {
                        const groupedByCategory = parsedResult.checklist.reduce((acc, current) => {
                            (acc[current.category] = acc[current.category] || []).push(current.item);
                            return acc;
                        }, {});

                        let checklistHtml = '<h4 class="text-lg font-semibold mb-2 text-slate-800">Checklist Ki·ªÉm tra An to√†n H√†ng ng√†y</h4>';
                        for (const category in groupedByCategory) {
                            checklistHtml += `<p class="font-semibold mt-3 mb-1 text-slate-600">${category}:</p><ul class="list-disc list-inside space-y-1">`;
                            groupedByCategory[category].forEach(item => {
                                checklistHtml += `<li class="text-slate-700">${item}</li>`;
                            });
                            checklistHtml += `</ul>`;
                        }
                        container.innerHTML = `<div class="checklist-container">${checklistHtml}</div>`;
                    } else {
                        container.innerHTML = `<p class="text-center text-red-500">Kh√¥ng th·ªÉ t·∫°o checklist t·ª´ th√¥ng tin ƒë∆∞·ª£c cung c·∫•p.</p>`;
                    }
                } catch (e) {
                     container.innerHTML = `<p class="text-center text-red-500">L·ªói x·ª≠ l√Ω d·ªØ li·ªáu t·ª´ AI. Vui l√≤ng th·ª≠ l·∫°i.</p><p class="text-xs text-slate-400 mt-2">${result}</p>`;
                }
            }

            // --- Q&A Modal Logic ---
            fab.addEventListener('click', () => modalOverlay.classList.add('show'));
            closeModalBtn.addEventListener('click', () => modalOverlay.classList.remove('show'));
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) {
                    modalOverlay.classList.remove('show');
                }
            });

            qaSubmitBtn.addEventListener('click', handleQASubmit);
            qaInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') handleQASubmit();
            });

            async function handleQASubmit() {
                const question = qaInput.value.trim();
                if (!question) return;

                qaResponseArea.innerHTML = '<div class="loader"></div><p class="text-center text-slate-500">AI ƒëang suy nghƒ©...</p>';
                qaSubmitBtn.disabled = true;
                qaInput.disabled = true;

                const fullContext = JSON.stringify(fireSafetyData);
                const prompt = `B·∫°n l√† m·ªôt chuy√™n gia an to√†n PCCC t·∫°i s√¢n bay. D·ª±a v√†o to√†n b·ªô n·ªôi quy PCCC sau ƒë√¢y: ${fullContext}. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch ng·∫Øn g·ªçn, ch√≠nh x√°c v√† ch·ªâ d·ª±a v√†o th√¥ng tin ƒë∆∞·ª£c cung c·∫•p. C√¢u h·ªèi: "${question}"`;
                
                const answer = await callGemini(prompt);
                
                qaResponseArea.innerHTML = `<p>${answer.replace(/\n/g, '<br>')}</p>`;
                qaSubmitBtn.disabled = false;
                qaInput.disabled = false;
                qaInput.value = '';
            }

            // --- Initial Page Load ---
            Object.keys(fireSafetyData).forEach(key => {
                const zone = fireSafetyData[key];
                const card = document.createElement('div');
                card.className = 'nav-card bg-white p-6 rounded-lg shadow-md border-2 border-transparent cursor-pointer text-left';
                card.dataset.zoneKey = key;
                card.innerHTML = `<div class="flex items-start gap-4">
                                    <span class="text-4xl">${zone.icon}</span>
                                    <div>
                                        <h3 class="text-xl font-bold text-slate-800">${zone.title}</h3>
                                        <p class="text-slate-500 mt-1">${zone.description}</p>
                                    </div>
                                  </div>`;
                card.addEventListener('click', function() {
                    document.querySelectorAll('.nav-card').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    displayContent(key);
                });
                navContainer.appendChild(card);
            });
        });
    </script>
</body>
</html>
